---
title: "How to compute functional rarity indices using `funrar`"
author: "Matthias Greni√©"
date: "21 mai 2018"
output: pdf_document
bibliography: references.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

This document aims to guide you through the use of `funrar` to compute functional rarity indices.
The aim is to reproduce the analyses from [@Grenie_funrar_2017] by using the Mammals dataset published on Dryad [@Lawing_Data_2016] from [@Lawing_Community_2017]. We are going to describe the functional rarity of North American mammals from atlas data.
Before running the analysis be sure to install the different packages and download the needed datasets by running the following chunk:

```{r, eval = FALSE}

# Install package `devtools` to install development version of `funrar`
if (!require("devtools")) {
    install.packages("devtools")
}

# Install development version of funrar
devtools::install_github("Rekyt/funrar", build_vignettes = TRUE)

# Install development version of `rdryad` if missing to download the example
# dataset
devtools::install_github("ropensci/rdryad")

# Install `ggplot2` if missing
if (!require("ggplot2")) {
    install.packages("ggplot2")
}

# Create a tutorial directory in the current directory
if (!dir.exists("funrar_tutorial")) {
    dir.create("funrar_tutorial")
}

# Move to tutorial directory
setwd("funrar_tutorial")

if (!dir.exists("data")) {
    dir.create("data")
}

# Download the example dataset from Lawning et al. 2016
# <doi:10.5061/dryad.9t0n8>
tempfile("data/lawning_data.zip")
rdryad::dryad_fetch(
    rdryad::dryad_files(rdryad::handle2doi("10255/dryad.116171"))[1],
    destfile = "data/lawning_data.zip", mode = "wb")
unzip("data/lawning_data.zip", exdir = "data")
unlink("data/lawning_data.zip")
```

## Load Data

Now that all the necessary packages are installed and the example dataset
downloaded, we can begin by loading and describing the files in the archive.
@Lawing_Data_2016 mentioned in its an atlas dataset of North American mammals.
The trait matrix is in the `Traits.csv` file. It contains the trait information for all the mammal from the @Jones_PanTHERIA_2009 database.



## Compute distance matrix

Scale traits first

Gower's distance, Euclidean distance (continuous triaits, etc.)

**WARNING:** Make sure that column types correspond to trait values before
computing distances (ordinal traits as `ordered` factor for example).

`compute_dist_matrix()`

-----------
**NOTE**

`compute_dist_matrix()` is a wrapper around function `daisy()` in package
`cluster`. So you can use any other distance function as long as you feed a
`matrix` object to `funrar` function.
See for example `ade4::dist.ktab()`
-----------

## Compute rarity indices

### Notes on format

tidy() versus stack()

### Distinctiveness

Formula.

### Uniqueness

### Restrictedness

### Scarcity

### Other notes

Global Di computation, Local Ui computation,

Performance sparse matrices.

Other way of computing Ri

## Visualization

Indices distribution
Indices correlations
Functional Space
Maps

## References
